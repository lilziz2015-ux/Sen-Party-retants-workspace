<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Invoices — Sen Party Rentals Pro</title>
<link rel="stylesheet" href="assets/style.css">
</head>
<body>

<!-- Sidebar -->
<aside class="sidebar">
  <div class="logo">
    <img src="02B58D79-6737-47EA-8099-73006879E55A Small.jpeg" alt="Logo">
    <h2>Sen Party Rentals Pro</h2>
  </div>
  <nav>
    <a href="index.html">🏠 Dashboard</a>
    <a href="bookings.html">📅 Bookings</a>
    <a href="calendar.html">🗓️ Calendar</a>
    <a href="customers.html">👥 Customers</a>
    <a href="invoices.html" class="active">🧾 Invoices</a>
    <a href="delivery.html">🚚 Delivery</a>
    <a href="settings.html">⚙️ Settings</a>
  </nav>
</aside>

<!-- Main -->
<main class="main">
  <header class="topbar">
    <div>
      <h1>Invoices</h1>
      <p class="muted">Generate, print, and email invoices for customers.</p>
    </div>
  </header>

  <section class="card">
    <h2>Create Invoice</h2>
    <div class="form-grid">
      <div>
        <label>Customer Name</label>
        <input id="invName" placeholder="Full name">
      </div>
      <div>
        <label>Email</label>
        <input id="invEmail" type="email" placeholder="customer@email.com">
      </div>
      <div>
        <label>Phone</label>
        <input id="invPhone" placeholder="571-719-9575">
      </div>
      <div>
        <label>Event Date</label>
        <input id="invDate" type="date">
      </div>
      <div class="wide">
        <label>Items / Services</label>
        <textarea id="invItems" rows="4" placeholder="e.g. 1x Moonbounce ($250), 10x Chairs ($20)..."></textarea>
      </div>
      <div>
        <label>Subtotal ($)</label>
        <input id="invSubtotal" type="number" step="0.01">
      </div>
      <div>
        <label>Deposit ($)</label>
        <input id="invDeposit" type="number" step="0.01" value="0">
      </div>
      <div class="wide">
        <label>Upload Product Image (optional)</label>
        <input type="file" id="invImage" accept="image/*">
        <img id="imagePreview" style="max-width:200px;margin-top:10px;border-radius:10px;">
      </div>
    </div>

    <div class="toolbar">
      <button id="btnCreateInvoice" class="btn-primary">Generate Invoice</button>
    </div>
  </section>

  <section id="invoicePreview" class="card" style="display:none;">
    <div id="invoiceArea">
      <div class="invoice-header">
        <div class="invoice-logo">
          <img id="bizLogoDisplay" src="assets/logo.png" alt="Logo">
        </div>
        <div class="invoice-info">
          <h2 id="bizNameDisplay">Sen Party Rentals</h2>
          <p id="bizAddressDisplay">11910 Bradley Forest Rd, Manassas, VA</p>
          <p><b>Phone:</b> <span id="bizPhoneDisplay">571-719-9575</span></p>
          <p><b>Email:</b> <span id="bizEmailDisplay">senmoonbounce@gmail.com</span></p>
        </div>
      </div>
      <hr>
      <h3>Invoice</h3>
      <p><b>Customer:</b> <span id="custName"></span></p>
      <p><b>Event Date:</b> <span id="custDate"></span></p>
      <p><b>Email:</b> <span id="custEmail"></span> | <b>Phone:</b> <span id="custPhone"></span></p>
      <h4>Items</h4>
      <p id="custItems"></p>
      <img id="custImage" style="max-width:250px;border-radius:8px;margin:10px 0;">
      <h4>Totals</h4>
      <p>Subtotal: $<span id="custSubtotal"></span></p>
      <p>Tax (<span id="taxRateDisplay"></span>%): $<span id="custTax"></span></p>
      <p>Deposit: $<span id="custDeposit"></span></p>
      <h3>Balance Due: $<span id="custBalance"></span></h3>
      <p id="invoiceFooterDisplay" class="muted" style="margin-top:2rem;"></p>
    </div>
    <div class="toolbar">
      <button class="btn" onclick="window.print()">🖨️ Print</button>
    </div>
  </section>

  <footer>
    <p>© 2025 Sen Party Rentals Pro — Invoices</p>
  </footer>
</main>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const settings = JSON.parse(localStorage.getItem("spr.settings") || "{}");
  const el = id => document.getElementById(id);

  function fmt(num){ return Number(num || 0).toFixed(2); }

  el("btnCreateInvoice").addEventListener("click", () => {
    const name = el("invName").value;
    const email = el("invEmail").value;
    const phone = el("invPhone").value;
    const date = el("invDate").value;
    const items = el("invItems").value;
    const sub = parseFloat(el("invSubtotal").value || 0);
    const dep = parseFloat(el("invDeposit").value || 0);
    const taxRate = parseFloat(settings.taxRate || 0);
    const tax = sub * (taxRate / 100);
    const total = sub + tax;
    const balance = total - dep;

    el("invoicePreview").style.display = "block";
    el("custName").textContent = name;
    el("custDate").textContent = date;
    el("custEmail").textContent = email;
    el("custPhone").textContent = phone;
    el("custItems").textContent = items;
    el("custSubtotal").textContent = fmt(sub);
    el("taxRateDisplay").textContent = fmt(taxRate);
    el("custTax").textContent = fmt(tax);
    el("custDeposit").textContent = fmt(dep);
    el("custBalance").textContent = fmt(balance);
    el("invoiceFooterDisplay").textContent = settings.invoiceFooter || "Thank you for choosing Sen Party Rentals!";
    el("bizNameDisplay").textContent = settings.bizName || "Sen Party Rentals";
    el("bizAddressDisplay").textContent = settings.bizAddress || "";
    el("bizPhoneDisplay").textContent = settings.bizPhone || "";
    el("bizEmailDisplay").textContent = settings.bizEmail || "";
    if(settings.logoData) el("bizLogoDisplay").src = settings.logoData;
  });

  el("invImage").addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => el("imagePreview").src = reader.result;
    reader.readAsDataURL(file);
  });
});
</script>
</body>
</html>